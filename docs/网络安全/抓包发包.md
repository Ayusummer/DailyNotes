# 抓包发包

---

## 常用抓包工具

| 常用抓包工具 |                             特点                             |
| :----------: | :----------------------------------------------------------: |
|  Wireshark   |     通用抓包工具，简单易用，开源免费，具有强大的分析能力     |
|   Tcpdump    |     Linux，抓包功能强大，命令行工具，保存的文件是二进制      |
|   Windump    |                     Windows的Tcpdump工具                     |
|    Tshark    |                  Wireshark的Linux命令行工具                  |
|   Sniffer    | 支持协议解析;网络活动监视;专家分析系统(Expert )。Sniffer Portable具有超强的专家分析能力，价格昂贵。 |
|    Fidder    |  Http代理，它能记录所有客户端和服务器的Http和Https请求响应   |
|   Charles    |          设置代理抓取http包，MAC上对Charles支持更好          |
|   OmniPeek   |                 更适用于无线网络、语音等技术                 |
|   Firebug    |          Web调试工具，集成在Internet Explorer工具栏          |
|  HttpWatch   |   Web调试工具，网页浏览器Mozilla Firefox下的一款开发类插件   |
|    ......    |                                                              |


---

### TCPDUMP

Linux，抓包功能强大，命令行工具，保存的文件是二进制, cat 和 vim 无法打开

- 下载到本地使用wireshark界面网络分析工具进行网络包分析
- tcpdump本身的命令去读取

```bash
apt list | grep tcpdump
```

---

#### 帮助

```bash
tcpdump --help
```

```bash
man tcpdump
```

---

#### 语法

> https://tonydeng.github.io/sdn-handbook/linux/tcpdump.html
>
> ---

Capture Filter 语法(BPF)

```bash
tcpdump -nn -i eth0 tcp and host 192.168.1.163 and port 80
```

- `-nn` 中, 第一个 n 表示以 IP 地址的方式显示主机名, 第二个 n 表示以端口数字的形式代替服务名

```bash
tcpdump -nn -vs0 -i eth0 -c 100 -w 1.pcap
```

- `-vs0` 表示不限制包的大小

---

```bash
# 常用抓包命令, 抓取 eth1 网卡上和 host xxx 相互通信的流量
tcpdump -nn -vv -i eth1 -w xxx.pcap host xxx
```

---

### Wireshark

#### 安装相关

> [WinPcap · Wiki · Wireshark Foundation / wireshark · GitLab](https://gitlab.com/wireshark/wireshark/-/wikis/WinPcap)
>
> ---

安装的时候会提示选择 `npcap` 还是 `winpcap`, 需要注意的是 `winpcap` 提供 `win95 - win8` 的支持, `npcap` 提供 `win7-win11` 的支持

---

#### 使用相关

#### Capture Filter 语法

```bash
udp dst port 4569	# 显示目的UDP端口为4569的封包。
ip src host 192.168.4.7	# 显示来源IP地址为192.168.4.7的封包。
host 192.168.4.7	# 显示目的或来源IP地址为192.168.4.7的封包。
src portrange 2000-5000	# 显示来源为TCP或UDP，并且端口在2000~5000范围内的封包。
not icmp	# 显示除icmp以外的封包。
src host 172.17.12.1 and not dst net 192.168.2.0/24	# 显示来源IP地址为172.17.12.1，但目的地址不是192.168.2.0/24的封包。
(src host 10.4.1.12 or src net 10.6.0.0/16) and tcp dst portrange 200-10000 and dst net 10.0.0.0/8 # 显示来源IP为10.4.1.12或者来源网络为10.6.0.0/16，目的地TCP端口号在200至10000之间，并且目的位于网络10.0.0.0/8内的所有封包
```

---

## 常用发包工具

报文回放:（模拟的)

- TCPREPLAY
- Xcap
- Scapy

攻击软件︰(模拟的)

- Hping3
- NetCat
- sendip
- Nmap
- NetStress - http/dns/udp flood

客户端/服务器︰(真实的)

- 浏览器 – http/https/ftp client
- wget/curl - http/https 抓取
- cmd和terminal - ftp/telnet client
- 3CDaemon - ftp/tftp/syslog Server
- Vsftpd - ftp Server
- Apache/Nginx - http/https Server
- Rsyslogd - syslog Server
- tftp/tftp-server ; tftp-hpa/tftpd-hpa - tftp Server
- sendmail/postfix - Mail Server
- Windows Server

---

### XCAP

需要先装 winpcap4.1.3 然后再安装 XCAP

XCAP是一个免费的网络发包工具，可以构造和发送常用的网络报文，如ARP、UDP、ICMP等。

- 新建Packet Group
- 新建报文名称

---

## Tcpreplay

```bash
# 安装
apt install tcpreplay
```

