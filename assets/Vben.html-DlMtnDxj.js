import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as c,c as i,a as n,d as s,b as t,e}from"./app-DxMJFouC.js";const l={},u=e('<h1 id="vben" tabindex="-1"><a class="header-anchor" href="#vben"><span>Vben</span></a></h1><ul><li><a href="#vben">Vben</a><ul><li><a href="#%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80">项目地址</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3">项目文档</a></li><li><a href="#%E5%BC%80%E5%A7%8B">开始</a><ul><li><a href="#%E7%8E%AF%E5%A2%83">环境</a><ul><li><a href="#vscode-%E6%8F%92%E4%BB%B6">VSCode 插件</a></li></ul></li><li><a href="#npm-script">npm Script</a></li><li><a href="#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E">目录说明</a></li></ul></li><li><a href="#%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE">项目配置</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83">项目规范</a><ul><li><a href="#commitlint">CommitLint</a></li></ul></li><li><a href="#%E5%90%8E%E7%AB%AF%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%85%A5">后端路由接入</a><ul><li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%E6%A8%A1%E5%BC%8F%E4%B8%BA-back">配置文件中修改权限模式为 BACK</a></li><li><a href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E8%B7%AF%E7%94%B1%E8%A1%A8">后端接口返回路由表</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E6%94%B9">数据库修改</a></li></ul></li><li><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E4%B9%8B%E8%B7%AF%E7%94%B1%E8%8F%9C%E5%8D%95%E6%9D%83%E9%99%90%E7%9A%84%E8%AE%BE%E8%AE%A1">深入理解之路由、菜单、权限的设计</a><ul><li><a href="#mark">mark</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96">项目初始化</a></li><li><a href="#%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE">路由配置</a></li><li><a href="#%E7%99%BB%E5%BD%95%E4%B8%BB%E4%BD%93%E6%B5%81%E7%A8%8B">登录主体流程</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF">获取用户信息</a></li><li><a href="#%E7%94%9F%E6%88%90%E8%B7%AF%E7%94%B1">生成路由</a></li><li><a href="#%E7%94%9F%E6%88%90%E8%8F%9C%E5%8D%95">生成菜单</a></li><li><a href="#%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB">路由守卫</a></li></ul></li><li><a href="#%E7%BB%84%E4%BB%B6">组件</a><ul><li><a href="#table">Table</a><ul><li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a><ul><li><a href="#%E8%A1%A8%E6%A0%BC%E7%B1%BB%E5%B1%9E%E6%80%A7%E8%B6%85%E8%BF%87%E9%95%BF%E5%BA%A6%E6%97%B6%E6%8D%A2%E8%A1%8C%E6%98%BE%E7%A4%BA">表格类属性超过长度时换行显示</a></li></ul></li></ul></li></ul></li><li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-1">常见问题</a><ul><li><a href="#%E5%8A%A0%E8%BD%BD%E7%BC%93%E6%85%A2">加载缓慢</a></li><li><a href="#tab-%E9%A1%B5%E5%88%87%E6%8D%A2%E5%90%8E%E9%A1%B5%E9%9D%A2%E7%A9%BA%E7%99%BD">tab 页切换后页面空白</a></li><li><a href="#404">404</a></li></ul></li><li><a href="#%E7%BE%A4%E5%86%85-qa">群内 QA</a></li><li><a href="#%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB">源码阅读</a><ul><li><a href="#login-%E4%B8%9A%E5%8A%A1">Login 业务</a><ul><li><a href="#api">api</a><ul><li><a href="#login">login</a></li><li><a href="#getuserinfo">getUserInfo</a></li></ul></li></ul></li></ul></li></ul></li></ul><hr><h2 id="关于项目的一些讨论" tabindex="-1"><a class="header-anchor" href="#关于项目的一些讨论"><span>关于项目的一些讨论</span></a></h2>',4),r={href:"https://juejin.cn/post/7066046772707065870",target:"_blank",rel:"noopener noreferrer"},k={href:"https://zhuanlan.zhihu.com/p/461510148",target:"_blank",rel:"noopener noreferrer"},d=n("hr",null,null,-1),m=n("h2",{id:"项目地址",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#项目地址"},[n("span",null,"项目地址")])],-1),v={href:"https://github.com/vbenjs/vue-vben-admin",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/vbenjs/vben-admin-thin-next",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/vbenjs/vue-vben-admin-doc",target:"_blank",rel:"noopener noreferrer"},g=n("hr",null,null,-1),f=n("h2",{id:"项目文档",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#项目文档"},[n("span",null,"项目文档")])],-1),E={href:"https://vvbin.cn/doc-next/",target:"_blank",rel:"noopener noreferrer"},y={href:"https://vvbin.cn/doc-next/guide/deploy.html",target:"_blank",rel:"noopener noreferrer"},w=e('<hr><h2 id="开始" tabindex="-1"><a class="header-anchor" href="#开始"><span>开始</span></a></h2><h3 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h3><p><code>Pnpm(6.32.4)</code> + <code>Node.js(16.14.2)</code> + <code>Git(2.36.0.windows.1)</code></p><hr><h4 id="vscode-插件" tabindex="-1"><a class="header-anchor" href="#vscode-插件"><span>VSCode 插件</span></a></h4>',6),A={href:"https://marketplace.visualstudio.com/items?itemName=antfu.iconify",target:"_blank",rel:"noopener noreferrer"},B={href:"https://marketplace.visualstudio.com/items?itemName=voorjaar.windicss-intellisense",target:"_blank",rel:"noopener noreferrer"},_={href:"https://marketplace.visualstudio.com/items?itemName=Lokalise.i18n-ally",target:"_blank",rel:"noopener noreferrer"},q={href:"https://marketplace.visualstudio.com/items?itemName=johnsoncodehk.volar",target:"_blank",rel:"noopener noreferrer"},R={href:"https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint",target:"_blank",rel:"noopener noreferrer"},x={href:"https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode",target:"_blank",rel:"noopener noreferrer"},L={href:"https://marketplace.visualstudio.com/items?itemName=stylelint.vscode-stylelint",target:"_blank",rel:"noopener noreferrer"},P={href:"https://marketplace.visualstudio.com/items?itemName=mikestead.dotenv",target:"_blank",rel:"noopener noreferrer"},S={href:"https://marketplace.visualstudio.com/items?itemName=naumovs.color-highlight",target:"_blank",rel:"noopener noreferrer"},D=n("p",null,[n("img",{src:"http://cdn.ayusummer233.top/img/202204231155705.png",alt:"image-20220423115459335"})],-1),F=e(`<hr><h3 id="npm-script" tabindex="-1"><a class="header-anchor" href="#npm-script"><span>npm Script</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
  <span class="token comment"># 安装依赖</span>
  <span class="token string">&quot;bootstrap&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yarn install&quot;</span>,
  <span class="token comment"># 运行项目</span>
  <span class="token string">&quot;serve&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;npm run dev&quot;</span>,
  <span class="token comment"># 运行项目</span>
  <span class="token string">&quot;dev&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vite&quot;</span>,
  <span class="token comment"># 构建项目</span>
  <span class="token string">&quot;build&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vite build &amp;&amp; esno ./build/script/postBuild.ts&quot;</span>,
  <span class="token comment"># 清空缓存后构建项目</span>
  <span class="token string">&quot;build:no-cache&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yarn clean:cache &amp;&amp; npm run build&quot;</span>,
  <span class="token comment"># 生成打包分析，在 \`Mac OS\` 电脑上执行完成后会自动打开界面，在 \`Window\` 电脑上执行完成后需要打开 \`./build/.cache/stats.html\` 查看</span>
  <span class="token string">&quot;report&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cross-env REPORT=true npm run build&quot;</span>,
  <span class="token comment"># 类型检查</span>
  <span class="token string">&quot;type:check&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vue-tsc --noEmit --skipLibCheck&quot;</span>,
  <span class="token comment"># 预览打包后的内容(先打包在进行预览) </span>
  <span class="token string">&quot;preview&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;npm run build &amp;&amp; vite preview&quot;</span>,
  <span class="token comment"># 直接预览本地 dist 文件目录</span>
  <span class="token string">&quot;preview:dist&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vite preview&quot;</span>,
  <span class="token comment"># 生成 ChangeLog</span>
  <span class="token string">&quot;log&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s&quot;</span>,
  <span class="token comment"># 删除缓存</span>
  <span class="token string">&quot;clean:cache&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rimraf node_modules/.cache/ &amp;&amp; rimraf node_modules/.vite&quot;</span>,
  <span class="token comment"># 删除 node_modules (\`window\` 系统手动删除该目录较慢，可以使用该命令来进行删除)</span>
  <span class="token string">&quot;clean:lib&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rimraf node_modules&quot;</span>,
  <span class="token comment"># 执行 eslint 校验，并修复部分问题</span>
  <span class="token string">&quot;lint:eslint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;eslint <span class="token entity" title="\\&quot;">\\&quot;</span>{src,mock}/**/*.{vue,ts,tsx}<span class="token entity" title="\\&quot;">\\&quot;</span> --fix&quot;</span>,
  <span class="token comment"># 执行 prettier 格式化(该命令会对项目所有代码进行 prettier 格式化，请谨慎执行) </span>
  <span class="token string">&quot;lint:prettier&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;prettier --write --loglevel warn <span class="token entity" title="\\&quot;">\\&quot;</span>src/**/*.{js,json,tsx,css,less,scss,vue,html,md}<span class="token entity" title="\\&quot;">\\&quot;</span>&quot;</span>,
  <span class="token comment"># 执行 stylelint 格式化</span>
  <span class="token string">&quot;lint:stylelint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;stylelint --fix <span class="token entity" title="\\&quot;">\\&quot;</span>**/*.{vue,less,postcss,css,scss}<span class="token entity" title="\\&quot;">\\&quot;</span> --cache --cache-location node_modules/.cache/stylelint/&quot;</span>,
  <span class="token string">&quot;lint:lint-staged&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;lint-staged -c ./.husky/lintstagedrc.js&quot;</span>,
  <span class="token string">&quot;lint:pretty&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pretty-quick --staged&quot;</span>,
  <span class="token comment"># 对打包结果进行 gzip 测试</span>
  <span class="token string">&quot;test:gzip&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;http-server dist --cors --gzip -c-1&quot;</span>,
  <span class="token comment"># 对打包目录进行 brotli 测试</span>
  <span class="token string">&quot;test:br&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;http-server dist --cors --brotli -c-1&quot;</span>,
  <span class="token comment"># 重新安装依赖，见下方说明</span>
  <span class="token string">&quot;reinstall&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rimraf yarn.lock &amp;&amp; rimraf package.lock.json &amp;&amp; rimraf node_modules &amp;&amp; npm run bootstrap&quot;</span>,
  <span class="token string">&quot;install:husky&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;is-ci || husky install&quot;</span>,
  <span class="token comment"># 生成图标集，见下方说明</span>
  <span class="token string">&quot;gen:icon&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;esno ./build/generate/icon/index.ts&quot;</span>,
  <span class="token string">&quot;postinstall&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;npm run install:husky&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),I=n("code",null,"生成图标集",-1),M={href:"https://vvbin.cn/doc-next/dep/icon.html#%E5%9B%BE%E6%A0%87%E9%9B%86%E9%A2%84%E7%94%9F%E6%88%90",target:"_blank",rel:"noopener noreferrer"},O=n("li",null,[n("p",null,[n("code",null,"重新安装依赖"),s(":")]),n("p",null,[s("该命令会先删除 "),n("code",null,"node_modules"),s("、"),n("code",null,"yarn.lock"),s("、"),n("code",null,"package.lock.json"),s(" 后再进行依赖重新安装(安装速度会明显变慢) 。")]),n("p",null,"接下来你可以修改代码进行业务开发了。我们内建了模拟数据、HMR 实时预览、状态管理、国际化、全局路由等各种实用的功能辅助开发，请阅读其他章节了解更多。")],-1),C=e(`<hr><h3 id="目录说明" tabindex="-1"><a class="header-anchor" href="#目录说明"><span>目录说明</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build <span class="token comment"># 打包脚本相关</span>
│   ├── config <span class="token comment"># 配置文件</span>
│   ├── generate <span class="token comment"># 生成器</span>
│   ├── script <span class="token comment"># 脚本</span>
│   └── vite <span class="token comment"># vite配置</span>
├── mock <span class="token comment"># mock文件夹</span>
├── public <span class="token comment"># 公共静态资源目录</span>
├── src <span class="token comment"># 主目录</span>
│   ├── api <span class="token comment"># 接口文件</span>
│   ├── assets <span class="token comment"># 资源文件</span>
│   │   ├── icons <span class="token comment"># icon sprite 图标文件夹</span>
│   │   ├── images <span class="token comment"># 项目存放图片的文件夹</span>
│   │   └── svg <span class="token comment"># 项目存放svg图片的文件夹</span>
│   ├── components <span class="token comment"># 公共组件-包括vben对antd的一些组件的重新封装以及自定义的公共组件</span>
│   ├── design <span class="token comment"># 样式文件</span>
│   ├── directives <span class="token comment"># 指令</span>
│   ├── enums <span class="token comment"># 枚举/常量(一般不会去改动)</span>
│   ├── hooks <span class="token comment"># hook</span>
│   │   ├── component <span class="token comment"># 组件相关hook</span>
│   │   ├── core <span class="token comment"># 基础hook</span>
│   │   ├── event <span class="token comment"># 事件相关hook</span>
│   │   ├── setting <span class="token comment"># 配置相关hook</span>
│   │   └── web <span class="token comment"># web相关hook</span>
│   ├── layouts <span class="token comment"># 布局文件</span>
│   │   ├── default <span class="token comment"># 默认布局</span>
│   │   ├── iframe <span class="token comment"># iframe布局</span>
│   │   └── page <span class="token comment"># 页面布局</span>
│   ├── locales <span class="token comment"># 多语言</span>
│   ├── logics <span class="token comment"># 逻辑</span>
│   ├── main.ts <span class="token comment"># 主入口</span>
│   ├── router <span class="token comment"># 路由配置</span>
│   ├── settings <span class="token comment"># 项目配置</span>
│   │   ├── componentSetting.ts <span class="token comment"># 组件配置</span>
│   │   ├── designSetting.ts <span class="token comment"># 样式配置</span>
│   │   ├── encryptionSetting.ts <span class="token comment"># 加密配置</span>
│   │   ├── localeSetting.ts <span class="token comment"># 多语言配置</span>
│   │   ├── projectSetting.ts <span class="token comment"># 项目配置</span>
│   │   └── siteSetting.ts <span class="token comment"># 站点配置</span>
│   ├── store <span class="token comment"># 数据仓库</span>
│   ├── utils <span class="token comment"># 工具类</span>
│   └── views <span class="token comment"># 页面</span>
├── <span class="token builtin class-name">test</span> <span class="token comment"># 测试</span>
│   └── server <span class="token comment"># 测试用到的服务</span>
│       ├── api <span class="token comment"># 测试服务器</span>
│       ├── upload <span class="token comment"># 测试上传服务器</span>
│       └── websocket <span class="token comment"># 测试ws服务器</span>
├── types <span class="token comment"># 类型文件</span>
├── vite.config.ts <span class="token comment"># vite配置文件</span>
└── windi.config.ts <span class="token comment"># windcss配置文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="项目配置" tabindex="-1"><a class="header-anchor" href="#项目配置"><span>项目配置</span></a></h2><p>用于修改项目的配色、布局、缓存、多语言、组件默认配置</p><hr><h2 id="项目规范" tabindex="-1"><a class="header-anchor" href="#项目规范"><span>项目规范</span></a></h2>`,8),T={href:"https://vvbin.cn/doc-next/dep/lint.html",target:"_blank",rel:"noopener noreferrer"},U=e('<hr><h3 id="commitlint" tabindex="-1"><a class="header-anchor" href="#commitlint"><span>CommitLint</span></a></h3><p>commit-lint 的配置位于项目根目录下 <code>commitlint.config.js</code></p><p><img src="http://cdn.ayusummer233.top/img/202205031434826.png" alt="image-20220503143453435"></p><hr><h2 id="后端路由接入" tabindex="-1"><a class="header-anchor" href="#后端路由接入"><span>后端路由接入</span></a></h2><h3 id="配置文件中修改权限模式为-back" tabindex="-1"><a class="header-anchor" href="#配置文件中修改权限模式为-back"><span>配置文件中修改权限模式为 BACK</span></a></h3>',7),N={href:"https://github.com/vbenjs/vue-vben-admin/tree/main/src/settings/projectSetting.ts",target:"_blank",rel:"noopener noreferrer"},j=e('<p>将系统内权限模式改为 <code>BACK</code> 模式开启权限由后台动态获取</p><p><img src="http://cdn.ayusummer233.top/img/202205030738082.png" alt="image-20220503073803911"></p><blockquote><p>后台返回角色, 前端根据返回结果显示界面等</p></blockquote><p>配置改完后要清缓存:</p><p><img src="http://cdn.ayusummer233.top/img/202205030716480.png" alt="image-20220503071625298"></p><p>最基本的静态路由存放在 <code>src/router/routes/index.ts</code> 中, 包含根路由以及登录页面</p><p><img src="http://cdn.ayusummer233.top/img/202205030712969.png" alt="image-20220503071246721"></p><p>原本前端路由情况下登入操作的请求及响应如下:</p><p><img src="http://cdn.ayusummer233.top/img/202205030732941.png" alt="image-20220503073244809"></p><p><img src="http://cdn.ayusummer233.top/img/202205030742550.png" alt="image-20220503074215472"></p><hr><h3 id="后端接口返回路由表" tabindex="-1"><a class="header-anchor" href="#后端接口返回路由表"><span>后端接口返回路由表</span></a></h3><hr><p>切换后端路由后登录操作请求资源如下:</p><p><img src="http://cdn.ayusummer233.top/img/202205030743271.png" alt="image-20220503074342187"></p><hr><p><code>login</code>:</p><p><img src="http://cdn.ayusummer233.top/img/202205030745837.png" alt="image-20220503074514748"></p><p><img src="http://cdn.ayusummer233.top/img/202205030745723.png" alt="image-20220503074552655"></p><p><img src="http://cdn.ayusummer233.top/img/202205030744462.png" alt="image-20220503074450395"></p><hr><p><code>getUserInfo</code>:</p><p><img src="http://cdn.ayusummer233.top/img/202205030746282.png" alt="image-20220503074657195"></p><p><img src="http://cdn.ayusummer233.top/img/202205030747383.png" alt="image-20220503074711295"></p><hr><p>登陆成功获取 <code>权限码(PermCode</code>, <code>菜单(MenuList)</code></p><p><code>getPermCode</code>:</p><p><img src="http://cdn.ayusummer233.top/img/202205030748072.png" alt="image-20220503074845976"></p><p><img src="http://cdn.ayusummer233.top/img/202205030748697.png" alt="image-20220503074857618"></p><hr><p><code>getMenuList</code>:</p><p><img src="http://cdn.ayusummer233.top/img/202205030749194.png" alt="image-20220503074940111"></p><p><img src="http://cdn.ayusummer233.top/img/202205030750750.png" alt="image-20220503075017643"></p><hr><p>以及一个图标请求:</p><p><img src="http://cdn.ayusummer233.top/img/202205030751576.png" alt="image-20220503075123487"></p><p><img src="http://cdn.ayusummer233.top/img/202205030751456.png" alt="image-20220503075133396"></p><p><img src="http://cdn.ayusummer233.top/img/202205030751031.png" alt="image-20220503075147948"></p><blockquote><p>不过这个请求明显是发往站外的, 就不用写了</p></blockquote><hr><p>重点说说 <code>MenuList</code>:</p><p><img src="http://cdn.ayusummer233.top/img/202205030749194.png" alt="image-20220503074940111"></p><p><img src="http://cdn.ayusummer233.top/img/202205030750750.png" alt="image-20220503075017643"></p><p><img src="http://cdn.ayusummer233.top/img/202205030758420.png" alt="image-20220503075834271"></p><p><img src="http://cdn.ayusummer233.top/img/202205030812505.png" alt="image-20220503081228333"></p><hr><p>在 <code>.env.development</code> 中关掉 <code>mock</code> 后再删除缓存放回登录页面登录, 那么就会</p><p><img src="http://cdn.ayusummer233.top/img/202205030838782.png" alt=""></p><p>这个请求地址和之前一致, 那么可以保留 mock, 然后用转发慢慢联调(</p><h3 id="数据库修改" tabindex="-1"><a class="header-anchor" href="#数据库修改"><span>数据库修改</span></a></h3><p>在数据库中新建一个 <code>router</code> 表</p><p>字段根据上面的 <code>menuList</code> 设置:</p><p><img src="http://cdn.ayusummer233.top/img/202205030821797.png" alt="image-20220503082151720"></p><p><img src="http://cdn.ayusummer233.top/img/202205030822719.png" alt="image-20220503082207631"></p><blockquote><p>后续内容未完成, go 接触的不多且当前时间比较紧, 打算自己嗯用 FastAPI 搓</p></blockquote><hr><h2 id="深入理解之路由、菜单、权限的设计" tabindex="-1"><a class="header-anchor" href="#深入理解之路由、菜单、权限的设计"><span>深入理解之路由、菜单、权限的设计</span></a></h2>',57),V={href:"https://juejin.cn/post/7001851383607459848",target:"_blank",rel:"noopener noreferrer"},G=e(`<h3 id="mark" tabindex="-1"><a class="header-anchor" href="#mark"><span>mark</span></a></h3><ul><li>路由是怎么自动加载并生成菜单的？</li><li>菜单权限模式分别有什么不同，怎么做的区分和处理？</li><li>权限的认证流程和初始化是怎么完成的？</li></ul><hr><h3 id="项目初始化" tabindex="-1"><a class="header-anchor" href="#项目初始化"><span>项目初始化</span></a></h3><p><code>src/main.ts</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Configure store</span>
  <span class="token comment">// 使用 pinia</span>
  <span class="token function">setupStore</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Initialize internal system configuration</span>
  <span class="token comment">// 初始化系统配置: 项目配置, 样式主题, 持久化缓存等</span>
  <span class="token function">initAppConfigStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Register global components</span>
  <span class="token comment">// 注册全局组件</span>
  <span class="token function">registerGlobComp</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Multilingual configuration</span>
  <span class="token comment">// Asynchronous case: language files may be obtained from the server side</span>
  <span class="token comment">// 多语言配置(国际化配置)</span>
  <span class="token keyword">await</span> <span class="token function">setupI18n</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Configure routing</span>
  <span class="token comment">// 路由配置</span>
  <span class="token function">setupRouter</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// router-guard</span>
  <span class="token comment">// 路由守卫: 权限判断, 初始化缓存数据等</span>
  <span class="token function">setupRouterGuard</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Register global directive</span>
  <span class="token comment">// 注册全局指令</span>
  <span class="token function">setupGlobDirectives</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Configure global error handling</span>
  <span class="token comment">// 配置全局错误处理</span>
  <span class="token function">setupErrorHandle</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// https://next.router.vuejs.org/api/#isready</span>
  <span class="token comment">// await router.isReady();</span>

  app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="路由配置" tabindex="-1"><a class="header-anchor" href="#路由配置"><span>路由配置</span></a></h3><p>实现自动加载 <code>modules</code> 下的路由文件并生成路由配置信息和一些通用的配置。</p><p><code>src/router/routes/index.ts</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> AppRouteRecordRaw<span class="token punctuation">,</span> AppRouteModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/router/types&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">PAGE_NOT_FOUND_ROUTE</span><span class="token punctuation">,</span> <span class="token constant">REDIRECT_ROUTE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/router/routes/basic&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> mainOutRoutes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./mainOut&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PageEnum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/enums/pageEnum&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/hooks/web/useI18n&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 自动加载 ./modules 目录下的路由模块</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">globEager</span><span class="token punctuation">(</span><span class="token string">&#39;./modules/**/*.ts&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routeModuleList<span class="token operator">:</span> AppRouteModule<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> modules<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>default <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> modList <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token operator">...</span>mod<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span>mod<span class="token punctuation">]</span><span class="token punctuation">;</span>
  routeModuleList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>modList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取的路由并未立即注册，而是等权限认证完后通过 router.addRoutes 添加到路由实例，实现权限的过滤</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> asyncRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">PAGE_NOT_FOUND_ROUTE</span><span class="token punctuation">,</span> <span class="token operator">...</span>routeModuleList<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> RootRoute<span class="token operator">:</span> AppRouteRecordRaw <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&#39;Root&#39;</span><span class="token punctuation">,</span>
  redirect<span class="token operator">:</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&#39;Root&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> LoginRoute<span class="token operator">:</span> AppRouteRecordRaw <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&#39;Login&#39;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;/@/views/sys/login/Login.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&#39;routes.basic.login&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Basic routing without permission</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> basicRoutes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 登录路由</span>
  LoginRoute<span class="token punctuation">,</span>
  <span class="token comment">// 跟路由</span>
  RootRoute<span class="token punctuation">,</span>
  <span class="token comment">// 新页面 /main-out</span>
  <span class="token operator">...</span>mainOutRoutes<span class="token punctuation">,</span>
  <span class="token comment">// 重定向路由</span>
  <span class="token constant">REDIRECT_ROUTE</span><span class="token punctuation">,</span>
  <span class="token comment">// 404</span>
  <span class="token constant">PAGE_NOT_FOUND_ROUTE</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="登录主体流程" tabindex="-1"><a class="header-anchor" href="#登录主体流程"><span>登录主体流程</span></a></h3><p>点击登录获取用户信息，存储使用的 <code>pinia</code> 实现。</p><p><code>src\\views\\sys\\login\\LoginForm.vue</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 获取用户信息, 存储使用 pinia</span>
<span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  password<span class="token operator">:</span> data<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
  username<span class="token operator">:</span> data<span class="token punctuation">.</span>account<span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span> <span class="token comment">//不要默认的错误提示</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>src\\store\\modules\\user.ts</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>    <span class="token doc-comment comment">/**
     * <span class="token keyword">@description</span>: login
     */</span>
    <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span>
      params<span class="token operator">:</span> LoginParams <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
        goHome<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
        mode<span class="token operator">?</span><span class="token operator">:</span> ErrorMessageMode<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>GetUserInfoModel <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> goHome <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> mode<span class="token punctuation">,</span> <span class="token operator">...</span>loginParams <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
        <span class="token comment">// 1. 调用登录接口</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loginApi</span><span class="token punctuation">(</span>loginParams<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>

        <span class="token comment">// save token</span>
        <span class="token comment">// 2. 设置 token 并存储本地缓存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">afterLoginAction</span><span class="token punctuation">(</span>goHome<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">afterLoginAction</span><span class="token punctuation">(</span>goHome<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>GetUserInfoModel <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>getToken<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token comment">// get user info</span>
      <span class="token comment">// 3. 获取用户信息</span>
      <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserInfoAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> sessionTimeout <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sessionTimeout<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sessionTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> permissionStore <span class="token operator">=</span> <span class="token function">usePermissionStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>permissionStore<span class="token punctuation">.</span>isDynamicAddedRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 4. 获取路由配置并动态添加路由配置</span>
          <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token keyword">await</span> permissionStore<span class="token punctuation">.</span><span class="token function">buildRoutesAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            router<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span>route <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> RouteRecordRaw<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          router<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token constant">PAGE_NOT_FOUND_ROUTE</span> <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> RouteRecordRaw<span class="token punctuation">)</span><span class="token punctuation">;</span>
          permissionStore<span class="token punctuation">.</span><span class="token function">setDynamicAddedRoute</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        goHome <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">await</span> router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>userInfo<span class="token operator">?.</span>homePath <span class="token operator">||</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> userInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">getUserInfoAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserInfo <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>getToken<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> userInfo<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> roleList <span class="token operator">=</span> roles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">as</span> RoleEnum<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRoleList</span><span class="token punctuation">(</span>roleList<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        userInfo<span class="token punctuation">.</span>roles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRoleList</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> userInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="获取用户信息" tabindex="-1"><a class="header-anchor" href="#获取用户信息"><span>获取用户信息</span></a></h3><p><code>src\\store\\modules\\user.ts</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>    <span class="token keyword">async</span> <span class="token function">getUserInfoAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserInfo <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>getToken<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> userInfo<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> roleList <span class="token operator">=</span> roles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">as</span> RoleEnum<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置权限列表, 并存储本地缓存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRoleList</span><span class="token punctuation">(</span>roleList<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        userInfo<span class="token punctuation">.</span>roles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRoleList</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 设置用户信息, 并存储本地缓存</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> userInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="生成路由" tabindex="-1"><a class="header-anchor" href="#生成路由"><span>生成路由</span></a></h3><p>登录成功之后调用 <code>buildRoutesAction</code> 获取路由配置、生成菜单配置。</p><p><code>src\\store\\modules\\permission.ts\\userPermissionStore/actions/buildRoutesAction()</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>    <span class="token keyword">async</span> <span class="token function">buildRoutesAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AppRouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useI18n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> appStore <span class="token operator">=</span> <span class="token function">useAppStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> routes<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> roleList <span class="token operator">=</span> <span class="token function">toRaw</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>getRoleList<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 获取权限模式</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> permissionMode <span class="token operator">=</span> projectSetting<span class="token punctuation">.</span>permissionMode <span class="token punctuation">}</span> <span class="token operator">=</span> appStore<span class="token punctuation">.</span>getProjectConfig<span class="token punctuation">;</span>

      <span class="token keyword">const</span> <span class="token function-variable function">routeFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>route<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> meta <span class="token punctuation">}</span> <span class="token operator">=</span> route<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token punctuation">}</span> <span class="token operator">=</span> meta <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>roles<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> roleList<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> roles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> <span class="token function-variable function">routeRemoveIgnoreFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>route<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> meta <span class="token punctuation">}</span> <span class="token operator">=</span> route<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ignoreRoute <span class="token punctuation">}</span> <span class="token operator">=</span> meta <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>ignoreRoute<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token doc-comment comment">/**
       * <span class="token keyword">@description</span> 根据设置的首页path，修正routes中的affix标记(固定首页) 
       * */</span>
      <span class="token keyword">const</span> <span class="token function-variable function">patchHomeAffix</span> <span class="token operator">=</span> <span class="token punctuation">(</span>routes<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>routes <span class="token operator">||</span> routes<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> homePath<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> userStore<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>homePath <span class="token operator">||</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">patcher</span><span class="token punctuation">(</span>routes<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parentPath <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>parentPath<span class="token punctuation">)</span> parentPath <span class="token operator">=</span> parentPath <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">;</span>
          routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>route<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> children<span class="token punctuation">,</span> redirect <span class="token punctuation">}</span> <span class="token operator">=</span> route<span class="token punctuation">;</span>
            <span class="token keyword">const</span> currentPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token operator">?</span> path <span class="token operator">:</span> parentPath <span class="token operator">+</span> path<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>currentPath <span class="token operator">===</span> homePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>redirect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                homePath <span class="token operator">=</span> route<span class="token punctuation">.</span>redirect<span class="token operator">!</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                route<span class="token punctuation">.</span>meta <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">,</span> <span class="token punctuation">{</span> affix<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;end&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            children <span class="token operator">&amp;&amp;</span> children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">patcher</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> currentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">patcher</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 已处理完毕跳出循环</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 区分权限模式</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>permissionMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 前端方式控制(菜单和路由分开配置)</span>
        <span class="token keyword">case</span> PermissionModeEnum<span class="token punctuation">.</span><span class="token constant">ROLE</span><span class="token operator">:</span>
          <span class="token comment">// 根据权限过滤路由</span>
          routes <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>asyncRoutes<span class="token punctuation">,</span> routeFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          routes <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>routeFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// Convert multi-level routing to level 2 routing</span>
          <span class="token comment">// 将多级路由转换为二级路由</span>
          routes <span class="token operator">=</span> <span class="token function">flatMultiLevelRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// 前端方式控制(菜单和路由配置自动生成)</span>
        <span class="token keyword">case</span> PermissionModeEnum<span class="token punctuation">.</span><span class="token constant">ROUTE_MAPPING</span><span class="token operator">:</span>
          <span class="token comment">// 根据权限过滤路由</span>
          routes <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>asyncRoutes<span class="token punctuation">,</span> routeFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          routes <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>routeFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 通过转换路由生成菜单</span>
          <span class="token keyword">const</span> menuList <span class="token operator">=</span> <span class="token function">transformRouteToMenu</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          routes <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> routeRemoveIgnoreFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          routes <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>routeRemoveIgnoreFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          menuList<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>meta<span class="token operator">?.</span>orderNo <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>meta<span class="token operator">?.</span>orderNo <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 设置保存菜单列表</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFrontMenuList</span><span class="token punctuation">(</span>menuList<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// Convert multi-level routing to level 2 routing</span>
          <span class="token comment">// 将多级路由转换为二级路由</span>
          routes <span class="token operator">=</span> <span class="token function">flatMultiLevelRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">//  If you are sure that you do not need to do background dynamic permissions, please comment the entire judgment below</span>
        <span class="token comment">// 后台方式控制</span>
        <span class="token keyword">case</span> PermissionModeEnum<span class="token punctuation">.</span><span class="token constant">BACK</span><span class="token operator">:</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> createMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          createMessage<span class="token punctuation">.</span><span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            content<span class="token operator">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&#39;sys.app.menuLoading&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            duration<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// !Simulate to obtain permission codes from the background,</span>
          <span class="token comment">// this function may only need to be executed once, and the actual project can be put at the right time by itself</span>
          <span class="token comment">// 获取后台返回的菜单配置 /mock/sys/menu.ts</span>
          <span class="token keyword">let</span> routeList<span class="token operator">:</span> AppRouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changePermissionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            routeList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">getMenuList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> AppRouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// Dynamically introduce components</span>
          routeList <span class="token operator">=</span> <span class="token function">transformObjToRoute</span><span class="token punctuation">(</span>routeList<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">//  Background routing to menu structure</span>
          <span class="token comment">// 通过转换路由生成菜单</span>
          <span class="token keyword">const</span> backMenuList <span class="token operator">=</span> <span class="token function">transformRouteToMenu</span><span class="token punctuation">(</span>routeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 设置菜单列表</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setBackMenuList</span><span class="token punctuation">(</span>backMenuList<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// remove meta.ignoreRoute item</span>
          routeList <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>routeList<span class="token punctuation">,</span> routeRemoveIgnoreFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
          routeList <span class="token operator">=</span> routeList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>routeRemoveIgnoreFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 设置保存菜单列表</span>
          routeList <span class="token operator">=</span> <span class="token function">flatMultiLevelRoutes</span><span class="token punctuation">(</span>routeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
          routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">PAGE_NOT_FOUND_ROUTE</span><span class="token punctuation">,</span> <span class="token operator">...</span>routeList<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">ERROR_LOG_ROUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">patchHomeAffix</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> routes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="生成菜单" tabindex="-1"><a class="header-anchor" href="#生成菜单"><span>生成菜单</span></a></h3><p>根据不同的权限模式从不同的数据源获取菜单。</p><p><code>src\\router\\menus\\index.ts</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 自动加载 \`modules\` 目录下的菜单模块</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">globEager</span><span class="token punctuation">(</span><span class="token string">&#39;./modules/**/*.ts&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAsyncMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> permissionStore <span class="token operator">=</span> <span class="token function">usePermissionStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 后端模式 BACK</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBackMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 this.setBackMenuList(menuList) 设置的菜单</span>
    <span class="token keyword">return</span> permissionStore<span class="token punctuation">.</span>getBackMenuList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>meta<span class="token operator">?.</span>hideMenu <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>hideMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 前端模式(菜单由路由配置自动生成) ROUTE_MAPPING</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRouteMappingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 this.setFrontMenuList(menuList) 设置的菜单</span>
    <span class="token keyword">return</span> permissionStore<span class="token punctuation">.</span>getFrontMenuList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>hideMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 前端模式(菜单和路由分开配置) ROLE</span>
  <span class="token keyword">return</span> staticMenus<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在菜单组件中获取菜单配置渲染。</p><p><code>src\\layouts\\default\\menu\\index.vue\\scrupt\\default\\setup\\renderMenu()</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>      <span class="token comment">// 在菜单组件中获取菜单配置渲染</span>
      <span class="token keyword">function</span> <span class="token function">renderMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> menus<span class="token punctuation">,</span> <span class="token operator">...</span>menuProps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">unref</span><span class="token punctuation">(</span>getCommonProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log(menus);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>menus <span class="token operator">||</span> <span class="token operator">!</span>menus<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>props<span class="token punctuation">.</span>isHorizontal <span class="token operator">?</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>SimpleMenu <span class="token punctuation">{</span><span class="token operator">...</span>menuProps<span class="token punctuation">}</span> isSplitMenu<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">unref</span><span class="token punctuation">(</span>getSplit<span class="token punctuation">)</span><span class="token punctuation">}</span> items<span class="token operator">=</span><span class="token punctuation">{</span>menus<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>BasicMenu
            <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">(</span>menuProps <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            isHorizontal<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>isHorizontal<span class="token punctuation">}</span>
            type<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">unref</span><span class="token punctuation">(</span>getMenuType<span class="token punctuation">)</span><span class="token punctuation">}</span>
            showLogo<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">unref</span><span class="token punctuation">(</span>getIsShowLogo<span class="token punctuation">)</span><span class="token punctuation">}</span>
            mode<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">unref</span><span class="token punctuation">(</span>getComputedMenuMode <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            items<span class="token operator">=</span><span class="token punctuation">{</span>menus<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="路由守卫" tabindex="-1"><a class="header-anchor" href="#路由守卫"><span>路由守卫</span></a></h3><p>判断是否登录以及刷新之后的初始化。</p><p><code>src\\router\\guard\\permissionGuard.ts</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createPermissionGuard</span><span class="token punctuation">(</span>router<span class="token operator">:</span> Router<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token function">useUserStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> permissionStore <span class="token operator">=</span> <span class="token function">usePermissionStoreWithOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      from<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token constant">ROOT_PATH</span> <span class="token operator">&amp;&amp;</span>
      to<span class="token punctuation">.</span>path <span class="token operator">===</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span> <span class="token operator">&amp;&amp;</span>
      userStore<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>homePath <span class="token operator">&amp;&amp;</span>
      userStore<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>homePath <span class="token operator">!==</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>homePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> token <span class="token operator">=</span> userStore<span class="token punctuation">.</span>getToken<span class="token punctuation">;</span>

    <span class="token comment">// Whitelist can be directly entered</span>
    <span class="token comment">// 白名单可以直接进入</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>whitePathList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token keyword">as</span> PageEnum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token constant">LOGIN_PATH</span> <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isSessionTimeout <span class="token operator">=</span> userStore<span class="token punctuation">.</span>getSessionTimeout<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">afterLoginAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSessionTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>query<span class="token operator">?.</span>redirect <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// token does not exist</span>
    <span class="token comment">// token不存在则重定向到登录页</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// You can access without permission. You need to set the routing meta.ignoreAuth to true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>ignoreAuth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// redirect login page</span>
      <span class="token keyword">const</span> redirectData<span class="token operator">:</span> <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> replace<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> query<span class="token operator">?</span><span class="token operator">:</span> Recordable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token constant">LOGIN_PATH</span><span class="token punctuation">,</span>
        replace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redirectData<span class="token punctuation">.</span>query <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>redirectData<span class="token punctuation">.</span>query<span class="token punctuation">,</span>
          redirect<span class="token operator">:</span> to<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span>redirectData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Jump to the 404 page after processing the login</span>
    <span class="token comment">// 处理登录后跳转到 404 页面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      from<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token constant">LOGIN_PATH</span> <span class="token operator">&amp;&amp;</span>
      to<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token constant">PAGE_NOT_FOUND_ROUTE</span><span class="token punctuation">.</span>name <span class="token operator">&amp;&amp;</span>
      to<span class="token punctuation">.</span>fullPath <span class="token operator">!==</span> <span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>homePath <span class="token operator">||</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>homePath <span class="token operator">||</span> PageEnum<span class="token punctuation">.</span><span class="token constant">BASE_HOME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// get userinfo while last fetch time is empty</span>
    <span class="token comment">// 获取用户信息 userinfo / roleList</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>getLastUpdateTime <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> userStore<span class="token punctuation">.</span><span class="token function">getUserInfoAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根据判断是否重新获取动态路由</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionStore<span class="token punctuation">.</span>getIsDynamicAddedRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token keyword">await</span> permissionStore<span class="token punctuation">.</span><span class="token function">buildRoutesAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      router<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span>route <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> RouteRecordRaw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    router<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token constant">PAGE_NOT_FOUND_ROUTE</span> <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> RouteRecordRaw<span class="token punctuation">)</span><span class="token punctuation">;</span>

    permissionStore<span class="token punctuation">.</span><span class="token function">setDynamicAddedRoute</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token constant">PAGE_NOT_FOUND_ROUTE</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 动态添加路由后，此处应当重定向到fullPath，否则会加载404页面内容</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> to<span class="token punctuation">.</span>fullPath<span class="token punctuation">,</span> replace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> query<span class="token operator">:</span> to<span class="token punctuation">.</span>query <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> redirectPath <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirect <span class="token operator">||</span> to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> redirect <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>redirectPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> nextData <span class="token operator">=</span> to<span class="token punctuation">.</span>path <span class="token operator">===</span> redirect <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>to<span class="token punctuation">,</span> replace<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span> path<span class="token operator">:</span> redirect <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">next</span><span class="token punctuation">(</span>nextData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="组件" tabindex="-1"><a class="header-anchor" href="#组件"><span>组件</span></a></h2><hr><h3 id="table" tabindex="-1"><a class="header-anchor" href="#table"><span>Table</span></a></h3><h4 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h4><h6 id="表格类属性超过长度时换行显示" tabindex="-1"><a class="header-anchor" href="#表格类属性超过长度时换行显示"><span>表格类属性超过长度时换行显示</span></a></h6><p>设置 <code>useTable</code> 的 <code>ellipsis</code> 属性为 <code>false</code> 即可:</p><p><img src="http://cdn.ayusummer233.top/img/202205131940818.png" alt="image-20220513194050415"></p><p><img src="http://cdn.ayusummer233.top/img/202205131942021.png" alt="image-20220513194206793"></p><hr><h2 id="常见问题-1" tabindex="-1"><a class="header-anchor" href="#常见问题-1"><span>常见问题</span></a></h2><hr><h3 id="加载缓慢" tabindex="-1"><a class="header-anchor" href="#加载缓慢"><span>加载缓慢</span></a></h3><p>项目运行后第一次加载会加载所有的包, 因此比较慢, 后面热更新就比较快了</p><hr><h3 id="tab-页切换后页面空白" tabindex="-1"><a class="header-anchor" href="#tab-页切换后页面空白"><span>tab 页切换后页面空白</span></a></h3>`,56),H={href:"https://vvbin.cn/doc-next/other/faq.html#tab-%E9%A1%B5%E5%88%87%E6%8D%A2%E5%90%8E%E9%A1%B5%E9%9D%A2%E7%A9%BA%E7%99%BD",target:"_blank",rel:"noopener noreferrer"},z=e(`<p>这是由于开启了路由切换动画,且对应的页面组件存在多个根节点导致的，在页面最外层添加<code>&lt;div&gt;&lt;/div&gt;</code>即可</p><p><strong>错误示例</strong></p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 注释也算一个节点 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>text h1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>text h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>正确示例</strong></p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>text h1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>text h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>PS:</p><ul><li>如果想使用多个根标签，可以禁用路由切换动画</li><li>template 下面的根注释节点也算一个节点</li></ul></blockquote><hr><h3 id="_404" tabindex="-1"><a class="header-anchor" href="#_404"><span>404</span></a></h3><p>后端也能接收到的话说明请求地址写错了😅</p><hr><h2 id="群内-qa" tabindex="-1"><a class="header-anchor" href="#群内-qa"><span>群内 QA</span></a></h2><hr><h2 id="源码阅读" tabindex="-1"><a class="header-anchor" href="#源码阅读"><span>源码阅读</span></a></h2><h3 id="login-业务" tabindex="-1"><a class="header-anchor" href="#login-业务"><span>Login 业务</span></a></h3><h4 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>api</span></a></h4><hr><h6 id="login" tabindex="-1"><a class="header-anchor" href="#login"><span>login</span></a></h6><p>用户点击登录按钮后首先会触发 <code>login</code> api</p><p><img src="http://cdn.ayusummer233.top/img/202205181808091.png" alt="image-20220518180854173"></p><p><img src="http://cdn.ayusummer233.top/img/202205181809451.png" alt="image-20220518180922032"></p><p><img src="http://cdn.ayusummer233.top/img/202205181809688.png" alt="image-20220518180907982"></p><blockquote><p>上面三个图示为在 mock 环境下默认的 login 请求情况</p></blockquote><p>api数据结构定义: <code>src\\api\\sys\\model\\userModel.ts</code>:</p><p>登录负载:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: Login interface parameters
 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">LoginParams</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>登录响应体:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RoleInfo</span> <span class="token punctuation">{</span>
  roleName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: Login interface return value
 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">LoginResultModel</span> <span class="token punctuation">{</span>
  userId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  token<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  role<span class="token operator">:</span> RoleInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到, 源码定义的响应结构和上面 mock 模式下的相应结果有出入, 后者多了两个参数: <code>desc</code> 和 <code>realName</code>, 不过这并不影响正常响应, 并且其实这两个参数会在后续会调用的 <code>getUserIno</code> 相应中包含</p><hr><h6 id="getuserinfo" tabindex="-1"><a class="header-anchor" href="#getuserinfo"><span>getUserInfo</span></a></h6><p><code>login</code> api 正确响应后会调用 <code>getUserInfo</code> api 获取用户信息</p><p><img src="http://cdn.ayusummer233.top/img/202205181820877.png" alt="image-20220518181829146"></p><p><img src="http://cdn.ayusummer233.top/img/202205181820923.png" alt="image-20220518182037436"></p><blockquote><p>上面2个图示为在 mock 环境下默认的 <code>getUserInfo</code> 请求情况</p></blockquote><p>获取用户信息响应结构:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: Get user information return value
 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">GetUserInfoModel</span> <span class="token punctuation">{</span>
  roles<span class="token operator">:</span> RoleInfo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 用户id</span>
  userId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token comment">// 用户名</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">// 真实名字</span>
  realName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">// 头像</span>
  avatar<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">// 介绍</span>
  desc<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与 <code>login</code> 类似, <code>getUserInfo</code> 的响应体也多了一些未定义的参数, 不过并不影响实际运作</p>`,37);function K(W,Q){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("blockquote",null,[n("p",null,[n("a",r,[s("Vue vben admin - 新鲜出炉的高颜值管理后台UI框架，基于 Vue3 和 Ant Design Vue - 掘金 (juejin.cn)"),t(a)])]),n("p",null,[n("a",k,[s("最好用的 8 款 Vue admin 后台管理系统测评 - 知乎 (zhihu.com)"),t(a)])])]),d,m,n("p",null,[n("a",v,[s("vbenjs/vue-vben-admin: A modern vue admin. It is based on Vue3, vite and TypeScript. It's fast！ (github.com)"),t(a)])]),n("p",null,[n("a",b,[s("vbenjs/vben-admin-thin-next: vue-vben-admin-2.0 mini template.vue3,vite,typescript (github.com)"),t(a)])]),n("p",null,[n("a",h,[s("vbenjs/vue-vben-admin-doc: vue-vben-admin-doc (github.com)"),t(a)])]),g,f,n("blockquote",null,[n("p",null,[n("a",E,[s("Home | Vben Admin (vvbin.cn)"),t(a)])]),n("p",null,[n("a",y,[s("构建&部署 | Vben Admin (vvbin.cn)"),t(a)])])]),w,n("ul",null,[n("li",null,[n("p",null,[n("a",A,[s("Iconify IntelliSense"),t(a)]),s(" - Iconify 图标插件")])]),n("li",null,[n("p",null,[n("a",B,[s("windicss IntelliSense"),t(a)]),s(" - windicss 提示插件")])]),n("li",null,[n("p",null,[n("a",_,[s("I18n-ally"),t(a)]),s(" - i18n 插件")])]),n("li",null,[n("p",null,[n("a",q,[s("Volar"),t(a)]),s(" - 官方推荐 Vue3 插件")])]),n("li",null,[n("p",null,[n("a",R,[s("ESLint"),t(a)]),s(" - 脚本代码检查")])]),n("li",null,[n("p",null,[n("a",x,[s("Prettier"),t(a)]),s(" - 代码格式化")])]),n("li",null,[n("p",null,[n("a",L,[s("Stylelint"),t(a)]),s(" - css 格式化")])]),n("li",null,[n("p",null,[n("a",P,[s("DotENV"),t(a)]),s(" - .env 文件 高亮")])]),n("li",null,[n("p",null,[n("a",S,[s("Color Highlight"),t(a)]),s(" - 颜色代码高亮显示")]),D])]),F,n("ul",null,[n("li",null,[n("p",null,[I,s(": 该命令会生成所选择的图标集，提供给图标选择器使用。具体使用方式请查看 "),n("a",M,[s("图标集生成"),t(a)])])]),O]),C,n("blockquote",null,[n("p",null,[n("a",T,[s("Lint | Vben Admin (vvbin.cn)"),t(a)])])]),U,n("p",null,[n("a",N,[s("src/settings/projectSetting.ts"),t(a)])]),j,n("blockquote",null,[n("p",null,[n("a",V,[s("Vben Admin 深入理解之路由、菜单、权限的设计 - 掘金 (juejin.cn)"),t(a)])])]),G,n("blockquote",null,[n("p",null,[n("a",H,[s("常见问题 | Vben Admin (vvbin.cn)"),t(a)])])]),z])}const X=p(l,[["render",K],["__file","Vben.html.vue"]]),Z=JSON.parse('{"path":"/%E5%89%8D%E7%AB%AF/VUE/Vben.html","title":"Vben","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"关于项目的一些讨论","slug":"关于项目的一些讨论","link":"#关于项目的一些讨论","children":[]},{"level":2,"title":"项目地址","slug":"项目地址","link":"#项目地址","children":[]},{"level":2,"title":"项目文档","slug":"项目文档","link":"#项目文档","children":[]},{"level":2,"title":"开始","slug":"开始","link":"#开始","children":[{"level":3,"title":"环境","slug":"环境","link":"#环境","children":[]},{"level":3,"title":"npm Script","slug":"npm-script","link":"#npm-script","children":[]},{"level":3,"title":"目录说明","slug":"目录说明","link":"#目录说明","children":[]}]},{"level":2,"title":"项目配置","slug":"项目配置","link":"#项目配置","children":[]},{"level":2,"title":"项目规范","slug":"项目规范","link":"#项目规范","children":[{"level":3,"title":"CommitLint","slug":"commitlint","link":"#commitlint","children":[]}]},{"level":2,"title":"后端路由接入","slug":"后端路由接入","link":"#后端路由接入","children":[{"level":3,"title":"配置文件中修改权限模式为 BACK","slug":"配置文件中修改权限模式为-back","link":"#配置文件中修改权限模式为-back","children":[]},{"level":3,"title":"后端接口返回路由表","slug":"后端接口返回路由表","link":"#后端接口返回路由表","children":[]},{"level":3,"title":"数据库修改","slug":"数据库修改","link":"#数据库修改","children":[]}]},{"level":2,"title":"深入理解之路由、菜单、权限的设计","slug":"深入理解之路由、菜单、权限的设计","link":"#深入理解之路由、菜单、权限的设计","children":[{"level":3,"title":"mark","slug":"mark","link":"#mark","children":[]},{"level":3,"title":"项目初始化","slug":"项目初始化","link":"#项目初始化","children":[]},{"level":3,"title":"路由配置","slug":"路由配置","link":"#路由配置","children":[]},{"level":3,"title":"登录主体流程","slug":"登录主体流程","link":"#登录主体流程","children":[]},{"level":3,"title":"获取用户信息","slug":"获取用户信息","link":"#获取用户信息","children":[]},{"level":3,"title":"生成路由","slug":"生成路由","link":"#生成路由","children":[]},{"level":3,"title":"生成菜单","slug":"生成菜单","link":"#生成菜单","children":[]},{"level":3,"title":"路由守卫","slug":"路由守卫","link":"#路由守卫","children":[]}]},{"level":2,"title":"组件","slug":"组件","link":"#组件","children":[{"level":3,"title":"Table","slug":"table","link":"#table","children":[]}]},{"level":2,"title":"常见问题","slug":"常见问题-1","link":"#常见问题-1","children":[{"level":3,"title":"加载缓慢","slug":"加载缓慢","link":"#加载缓慢","children":[]},{"level":3,"title":"tab 页切换后页面空白","slug":"tab-页切换后页面空白","link":"#tab-页切换后页面空白","children":[]},{"level":3,"title":"404","slug":"_404","link":"#_404","children":[]}]},{"level":2,"title":"群内 QA","slug":"群内-qa","link":"#群内-qa","children":[]},{"level":2,"title":"源码阅读","slug":"源码阅读","link":"#源码阅读","children":[{"level":3,"title":"Login 业务","slug":"login-业务","link":"#login-业务","children":[]}]}],"git":{"createdTime":1667837365000,"updatedTime":1712912792000,"contributors":[{"name":"Ayusummer","email":"ayusummer233@gmail.com","commits":2},{"name":"233Official","email":"ayusummer233@qq.com","commits":1},{"name":"咸鱼型233","email":"ayusummer233@qq.com","commits":1}]},"readingTime":{"minutes":14.38,"words":4315},"filePathRelative":"前端/VUE/Vben.md","localizedDate":"2022年11月7日","excerpt":"\\n<ul>\\n<li><a href=\\"#vben\\">Vben</a>\\n<ul>\\n<li><a href=\\"#%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80\\">项目地址</a></li>\\n<li><a href=\\"#%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3\\">项目文档</a></li>\\n<li><a href=\\"#%E5%BC%80%E5%A7%8B\\">开始</a>\\n<ul>\\n<li><a href=\\"#%E7%8E%AF%E5%A2%83\\">环境</a>\\n<ul>\\n<li><a href=\\"#vscode-%E6%8F%92%E4%BB%B6\\">VSCode 插件</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"#npm-script\\">npm Script</a></li>\\n<li><a href=\\"#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E\\">目录说明</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"#%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE\\">项目配置</a></li>\\n<li><a href=\\"#%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83\\">项目规范</a>\\n<ul>\\n<li><a href=\\"#commitlint\\">CommitLint</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"#%E5%90%8E%E7%AB%AF%E8%B7%AF%E7%94%B1%E6%8E%A5%E5%85%A5\\">后端路由接入</a>\\n<ul>\\n<li><a href=\\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%E6%A8%A1%E5%BC%8F%E4%B8%BA-back\\">配置文件中修改权限模式为 BACK</a></li>\\n<li><a href=\\"#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E8%B7%AF%E7%94%B1%E8%A1%A8\\">后端接口返回路由表</a></li>\\n<li><a href=\\"#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E6%94%B9\\">数据库修改</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E4%B9%8B%E8%B7%AF%E7%94%B1%E8%8F%9C%E5%8D%95%E6%9D%83%E9%99%90%E7%9A%84%E8%AE%BE%E8%AE%A1\\">深入理解之路由、菜单、权限的设计</a>\\n<ul>\\n<li><a href=\\"#mark\\">mark</a></li>\\n<li><a href=\\"#%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96\\">项目初始化</a></li>\\n<li><a href=\\"#%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE\\">路由配置</a></li>\\n<li><a href=\\"#%E7%99%BB%E5%BD%95%E4%B8%BB%E4%BD%93%E6%B5%81%E7%A8%8B\\">登录主体流程</a></li>\\n<li><a href=\\"#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF\\">获取用户信息</a></li>\\n<li><a href=\\"#%E7%94%9F%E6%88%90%E8%B7%AF%E7%94%B1\\">生成路由</a></li>\\n<li><a href=\\"#%E7%94%9F%E6%88%90%E8%8F%9C%E5%8D%95\\">生成菜单</a></li>\\n<li><a href=\\"#%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB\\">路由守卫</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"#%E7%BB%84%E4%BB%B6\\">组件</a>\\n<ul>\\n<li><a href=\\"#table\\">Table</a>\\n<ul>\\n<li><a href=\\"#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98\\">常见问题</a>\\n<ul>\\n<li><a href=\\"#%E8%A1%A8%E6%A0%BC%E7%B1%BB%E5%B1%9E%E6%80%A7%E8%B6%85%E8%BF%87%E9%95%BF%E5%BA%A6%E6%97%B6%E6%8D%A2%E8%A1%8C%E6%98%BE%E7%A4%BA\\">表格类属性超过长度时换行显示</a></li>\\n</ul>\\n</li>\\n</ul>\\n</li>\\n</ul>\\n</li>\\n<li><a href=\\"#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-1\\">常见问题</a>\\n<ul>\\n<li><a href=\\"#%E5%8A%A0%E8%BD%BD%E7%BC%93%E6%85%A2\\">加载缓慢</a></li>\\n<li><a href=\\"#tab-%E9%A1%B5%E5%88%87%E6%8D%A2%E5%90%8E%E9%A1%B5%E9%9D%A2%E7%A9%BA%E7%99%BD\\">tab 页切换后页面空白</a></li>\\n<li><a href=\\"#404\\">404</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"#%E7%BE%A4%E5%86%85-qa\\">群内 QA</a></li>\\n<li><a href=\\"#%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB\\">源码阅读</a>\\n<ul>\\n<li><a href=\\"#login-%E4%B8%9A%E5%8A%A1\\">Login 业务</a>\\n<ul>\\n<li><a href=\\"#api\\">api</a>\\n<ul>\\n<li><a href=\\"#login\\">login</a></li>\\n<li><a href=\\"#getuserinfo\\">getUserInfo</a></li>\\n</ul>\\n</li>\\n</ul>\\n</li>\\n</ul>\\n</li>\\n</ul>\\n</li>\\n</ul>"}');export{X as comp,Z as data};
