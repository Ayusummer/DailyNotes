import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as i,o as r,c,a as e,d as t,b as n,e as s}from"./app-DxMJFouC.js";const d={},p=s(`<h1 id="抓包发包" tabindex="-1"><a class="header-anchor" href="#抓包发包"><span>抓包发包</span></a></h1><hr><h2 id="常用抓包工具" tabindex="-1"><a class="header-anchor" href="#常用抓包工具"><span>常用抓包工具</span></a></h2><table><thead><tr><th style="text-align:center;">常用抓包工具</th><th style="text-align:center;">特点</th></tr></thead><tbody><tr><td style="text-align:center;">Wireshark</td><td style="text-align:center;">通用抓包工具，简单易用，开源免费，具有强大的分析能力</td></tr><tr><td style="text-align:center;">Tcpdump</td><td style="text-align:center;">Linux，抓包功能强大，命令行工具，保存的文件是二进制</td></tr><tr><td style="text-align:center;">Windump</td><td style="text-align:center;">Windows的Tcpdump工具</td></tr><tr><td style="text-align:center;">Tshark</td><td style="text-align:center;">Wireshark的Linux命令行工具</td></tr><tr><td style="text-align:center;">Sniffer</td><td style="text-align:center;">支持协议解析;网络活动监视;专家分析系统(Expert )。Sniffer Portable具有超强的专家分析能力，价格昂贵。</td></tr><tr><td style="text-align:center;">Fidder</td><td style="text-align:center;">Http代理，它能记录所有客户端和服务器的Http和Https请求响应</td></tr><tr><td style="text-align:center;">Charles</td><td style="text-align:center;">设置代理抓取http包，MAC上对Charles支持更好</td></tr><tr><td style="text-align:center;">OmniPeek</td><td style="text-align:center;">更适用于无线网络、语音等技术</td></tr><tr><td style="text-align:center;">Firebug</td><td style="text-align:center;">Web调试工具，集成在Internet Explorer工具栏</td></tr><tr><td style="text-align:center;">HttpWatch</td><td style="text-align:center;">Web调试工具，网页浏览器Mozilla Firefox下的一款开发类插件</td></tr><tr><td style="text-align:center;">......</td><td style="text-align:center;"></td></tr></tbody></table><hr><h3 id="tcpdump" tabindex="-1"><a class="header-anchor" href="#tcpdump"><span>TCPDUMP</span></a></h3><p>Linux，抓包功能强大，命令行工具，保存的文件是二进制, cat 和 vim 无法打开</p><ul><li>下载到本地使用wireshark界面网络分析工具进行网络包分析</li><li>tcpdump本身的命令去读取</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">apt</span> list <span class="token operator">|</span> <span class="token function">grep</span> tcpdump
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h4 id="帮助" tabindex="-1"><a class="header-anchor" href="#帮助"><span>帮助</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>tcpdump <span class="token parameter variable">--help</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">man</span> tcpdump
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h4 id="语法" tabindex="-1"><a class="header-anchor" href="#语法"><span>语法</span></a></h4><blockquote><p>https://tonydeng.github.io/sdn-handbook/linux/tcpdump.html</p><hr></blockquote><p>Capture Filter 语法(BPF)</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>tcpdump <span class="token parameter variable">-nn</span> <span class="token parameter variable">-i</span> eth0 tcp and <span class="token function">host</span> <span class="token number">192.168</span>.1.163 and port <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>-nn</code> 中, 第一个 n 表示以 IP 地址的方式显示主机名, 第二个 n 表示以端口数字的形式代替服务名</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>tcpdump <span class="token parameter variable">-nn</span> <span class="token parameter variable">-vs0</span> <span class="token parameter variable">-i</span> eth0 <span class="token parameter variable">-c</span> <span class="token number">100</span> <span class="token parameter variable">-w</span> <span class="token number">1</span>.pcap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>-vs0</code> 表示不限制包的大小</li></ul><hr><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 常用抓包命令, 抓取 eth1 网卡上和 host xxx 相互通信的流量</span>
tcpdump <span class="token parameter variable">-nn</span> <span class="token parameter variable">-vv</span> <span class="token parameter variable">-i</span> eth1 <span class="token parameter variable">-w</span> xxx.pcap <span class="token function">host</span> xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="wireshark" tabindex="-1"><a class="header-anchor" href="#wireshark"><span>Wireshark</span></a></h3><h4 id="安装相关" tabindex="-1"><a class="header-anchor" href="#安装相关"><span>安装相关</span></a></h4>`,26),o={href:"https://gitlab.com/wireshark/wireshark/-/wikis/WinPcap",target:"_blank",rel:"noopener noreferrer"},h=e("hr",null,null,-1),u=s(`<p>安装的时候会提示选择 <code>npcap</code> 还是 <code>winpcap</code>, 需要注意的是 <code>winpcap</code> 提供 <code>win95 - win8</code> 的支持, <code>npcap</code> 提供 <code>win7-win11</code> 的支持</p><hr><h4 id="使用相关" tabindex="-1"><a class="header-anchor" href="#使用相关"><span>使用相关</span></a></h4><h4 id="capture-filter-语法" tabindex="-1"><a class="header-anchor" href="#capture-filter-语法"><span>Capture Filter 语法</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>udp dst port <span class="token number">4569</span>	<span class="token comment"># 显示目的UDP端口为4569的封包。</span>
<span class="token function">ip</span> src <span class="token function">host</span> <span class="token number">192.168</span>.4.7	<span class="token comment"># 显示来源IP地址为192.168.4.7的封包。</span>
<span class="token function">host</span> <span class="token number">192.168</span>.4.7	<span class="token comment"># 显示目的或来源IP地址为192.168.4.7的封包。</span>
src portrange <span class="token number">2000</span>-5000	<span class="token comment"># 显示来源为TCP或UDP，并且端口在2000~5000范围内的封包。</span>
not icmp	<span class="token comment"># 显示除icmp以外的封包。</span>
src <span class="token function">host</span> <span class="token number">172.17</span>.12.1 and not dst net <span class="token number">192.168</span>.2.0/24	<span class="token comment"># 显示来源IP地址为172.17.12.1，但目的地址不是192.168.2.0/24的封包。</span>
<span class="token punctuation">(</span>src <span class="token function">host</span> <span class="token number">10.4</span>.1.12 or src net <span class="token number">10.6</span>.0.0/16<span class="token punctuation">)</span> and tcp dst portrange <span class="token number">200</span>-10000 and dst net <span class="token number">10.0</span>.0.0/8 <span class="token comment"># 显示来源IP为10.4.1.12或者来源网络为10.6.0.0/16，目的地TCP端口号在200至10000之间，并且目的位于网络10.0.0.0/8内的所有封包</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="常用发包工具" tabindex="-1"><a class="header-anchor" href="#常用发包工具"><span>常用发包工具</span></a></h2><p>报文回放:(模拟的)</p><ul><li>TCPREPLAY</li><li>Xcap</li><li>Scapy</li></ul><p>攻击软件︰(模拟的)</p><ul><li>Hping3</li><li>NetCat</li><li>sendip</li><li>Nmap</li><li>NetStress - http/dns/udp flood</li></ul><p>客户端/服务器︰(真实的)</p><ul><li>浏览器 – http/https/ftp client</li><li>wget/curl - http/https 抓取</li><li>cmd和terminal - ftp/telnet client</li><li>3CDaemon - ftp/tftp/syslog Server</li><li>Vsftpd - ftp Server</li><li>Apache/Nginx - http/https Server</li><li>Rsyslogd - syslog Server</li><li>tftp/tftp-server ; tftp-hpa/tftpd-hpa - tftp Server</li><li>sendmail/postfix - Mail Server</li><li>Windows Server</li></ul><hr><h3 id="xcap" tabindex="-1"><a class="header-anchor" href="#xcap"><span>XCAP</span></a></h3><p>需要先装 winpcap4.1.3 然后再安装 XCAP</p><p>XCAP是一个免费的网络发包工具，可以构造和发送常用的网络报文，如ARP、UDP、ICMP等。</p><ul><li>新建Packet Group</li><li>新建报文名称</li></ul><hr><h3 id="curl" tabindex="-1"><a class="header-anchor" href="#curl"><span>curl</span></a></h3>`,20),m={href:"https://www.ruanyifeng.com/blog/2019/09/curl-reference.html",target:"_blank",rel:"noopener noreferrer"},g={href:"https://catonmat.net/cookbooks/curl",target:"_blank",rel:"noopener noreferrer"},b={href:"https://www.cnblogs.com/amnotgcs/p/14157442.html",target:"_blank",rel:"noopener noreferrer"},v=s(`<p>curl(Client URL) 用于请求 Web 服务器, 用的熟练的话完全可以取代 Postman 这类图形界面工具</p><p>不带有任何参数时，curl 就是发出 GET 请求。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><img src="http://cdn.ayusummer233.top/img/202212291053306.png" alt="image-20221229105323183"></p></blockquote><p><img src="http://cdn.ayusummer233.top/img/202301012049003.png" alt="image-20230101204931253"></p><hr><h4 id="a" tabindex="-1"><a class="header-anchor" href="#a"><span>-A</span></a></h4><p><code>-A</code>参数指定客户端的用户代理标头，即<code>User-Agent</code>。curl 的默认用户代理字符串是<code>curl/[version]</code>。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-A</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36&#39;</span> https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><img src="http://cdn.ayusummer233.top/img/202301012049630.png" alt="image-20230101204949059"></p></blockquote><p>也可以使用 <code>-A &#39;&#39;</code> 来移出 User-Agent 标头</p><p>或者使用 <code>-H &#39;User-Agent: xxx&#39;</code> 来自定义 User-Agent</p><hr><h4 id="b" tabindex="-1"><a class="header-anchor" href="#b"><span>-b</span></a></h4><p><code>-b</code>参数用来向服务器发送 Cookie。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-b</span> <span class="token string">&#39;foo=bar&#39;</span> https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如上命令会向服务器发送一个名为 <code>foo</code> 值为 <code>bar</code> 的 cookie</p><p>发送多个 cookie:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-b</span> <span class="token string">&#39;foo1=bar;foo2=bar2&#39;</span> https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>读取本地文件发送 cookie</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-b</span> cookies.txt https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>可以结合 -c 看下</p></blockquote><hr><h4 id="c" tabindex="-1"><a class="header-anchor" href="#c"><span>-c</span></a></h4><p><code>-c</code>参数将服务器设置的 Cookie 写入一个文件。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-c</span> cookies.txt https://www.baidu.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>上面命令将服务器的 HTTP 回应所设置 Cookie 写入文本文件<code>cookies.txt</code>。</p><blockquote><p><img src="http://cdn.ayusummer233.top/img/202301012050616.png" alt="image-20230101205003029"></p></blockquote><hr><h4 id="d" tabindex="-1"><a class="header-anchor" href="#d"><span>-d</span></a></h4><p><code>-d</code>参数用于发送 POST 请求的数据体。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> -d<span class="token string">&#39;login=emma＆password=123&#39;</span>-X POST https://www.example.com
<span class="token comment"># 或者</span>
<span class="token function">curl</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;login=emma&#39;</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;password=123&#39;</span> <span class="token parameter variable">-X</span> POST https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用<code>-d</code>参数以后，HTTP 请求会自动加上标头<code>Content-Type : application/x-www-form-urlencoded</code>。并且会自动将请求转为 POST 方法，因此可以省略<code>-X POST</code>。</p><p><code>-d</code>参数可以读取本地文本文件的数据，向服务器发送。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;@data.txt&#39;</span> https://google.com/login
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>上面命令读取<code>data.txt</code>文件的内容，作为数据体向服务器发送。</p><hr><h4 id="v" tabindex="-1"><a class="header-anchor" href="#v"><span>-v</span></a></h4><p><code>-v</code>参数输出通信的整个过程，用于调试。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-v</span> https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/img/202301020102262.png" alt="image-20230102010209089"></p><p><img src="http://cdn.ayusummer233.top/img/202301020102723.png" alt="image-20230102010255652"></p><p><code>--trace</code>参数也可以用于调试，还会输出原始的二进制数据。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--trace</span> - https://www.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/img/202301020103453.png" alt="image-20230102010325479"></p><p>......</p><p><img src="http://cdn.ayusummer233.top/img/202301020103804.png" alt="image-20230102010347548"></p><hr><h4 id="path-as-is" tabindex="-1"><a class="header-anchor" href="#path-as-is"><span>--path-as-is</span></a></h4><p>Do not squash .. sequences in URL path</p><p>不压缩 URL path 中的 .. 序列, 在做目录遍历的时候会用到</p><p>比如 **Apache HTTP Server 2.4.50 路径穿越漏洞(CVE-2021-42013) **</p><p>如果直接发明文的 .. 且不用 <code>--path-as-is</code> 的话就会把 <code>../</code> 全丢掉</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>curl -v http://192.168.2.31:8080/icons/../../../../../../../etc/passwd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><img src="http://cdn.ayusummer233.top/img/202301020044787.png" alt="image-20230102004413573"></p></blockquote><p>正确的利用方式:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-v</span> --path-as-is http://192.168.2.31:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/img/202301012208415.png" alt="image-20230101220853878"></p><p>使用了 <code>-v</code>参数输出通信的整个过程，用于调试。又使用了 <code>--path-as-is</code> 从而不压缩 <code>..</code> 序列</p><p><img src="http://cdn.ayusummer233.top/img/202301020044161.png" alt="image-20230102003813664"></p><blockquote><p>如果不使用 <code>--path-as-is</code> 则</p><p><img src="http://cdn.ayusummer233.top/img/202301020047898.png" alt="image-20230102004636433"></p><p><img src="http://cdn.ayusummer233.top/img/202301020044128.png" alt="image-20230102004028870"></p><p>与之前一样, 可以利用成功, 流量也一致, 说明 <code>--path-as-is</code> 只对明文的 <code>..</code> 生效, 编了码的话就没必要再加该参数了</p></blockquote><hr><h2 id="tcpreplay" tabindex="-1"><a class="header-anchor" href="#tcpreplay"><span>Tcpreplay</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">apt</span> <span class="token function">install</span> tcpreplay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,64);function k(x,f){const a=i("ExternalLinkIcon");return r(),c("div",null,[p,e("blockquote",null,[e("p",null,[e("a",o,[t("WinPcap · Wiki · Wireshark Foundation / wireshark · GitLab"),n(a)])]),h]),u,e("blockquote",null,[e("p",null,[e("a",m,[t("curl 的用法指南 - 阮一峰的网络日志 (ruanyifeng.com)"),n(a)])]),e("p",null,[e("a",g,[t("Curl Cookbook (catonmat.net)"),n(a)])]),e("p",null,[e("a",b,[t("curl 的使用，参数大全 - 那个白熊 - 博客园 (cnblogs.com)"),n(a)])])]),v])}const P=l(d,[["render",k],["__file","抓包发包.html.vue"]]),_=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%8A%93%E5%8C%85%E5%8F%91%E5%8C%85.html","title":"抓包发包","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"常用抓包工具","slug":"常用抓包工具","link":"#常用抓包工具","children":[{"level":3,"title":"TCPDUMP","slug":"tcpdump","link":"#tcpdump","children":[]},{"level":3,"title":"Wireshark","slug":"wireshark","link":"#wireshark","children":[]}]},{"level":2,"title":"常用发包工具","slug":"常用发包工具","link":"#常用发包工具","children":[{"level":3,"title":"XCAP","slug":"xcap","link":"#xcap","children":[]},{"level":3,"title":"curl","slug":"curl","link":"#curl","children":[]}]},{"level":2,"title":"Tcpreplay","slug":"tcpreplay","link":"#tcpreplay","children":[]}],"git":{"createdTime":1669687905000,"updatedTime":1709635981000,"contributors":[{"name":"咸鱼型233","email":"ayusummer233@qq.com","commits":2},{"name":"233Official","email":"ayusummer233@qq.com","commits":1},{"name":"Ayusummer","email":"ayusummer233@gmail.com","commits":1}]},"readingTime":{"minutes":4.97,"words":1491},"filePathRelative":"网络安全/抓包发包.md","localizedDate":"2022年11月29日","excerpt":"\\n<hr>\\n<h2>常用抓包工具</h2>\\n<table>\\n<thead>\\n<tr>\\n<th style=\\"text-align:center\\">常用抓包工具</th>\\n<th style=\\"text-align:center\\">特点</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td style=\\"text-align:center\\">Wireshark</td>\\n<td style=\\"text-align:center\\">通用抓包工具，简单易用，开源免费，具有强大的分析能力</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Tcpdump</td>\\n<td style=\\"text-align:center\\">Linux，抓包功能强大，命令行工具，保存的文件是二进制</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Windump</td>\\n<td style=\\"text-align:center\\">Windows的Tcpdump工具</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Tshark</td>\\n<td style=\\"text-align:center\\">Wireshark的Linux命令行工具</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Sniffer</td>\\n<td style=\\"text-align:center\\">支持协议解析;网络活动监视;专家分析系统(Expert )。Sniffer Portable具有超强的专家分析能力，价格昂贵。</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Fidder</td>\\n<td style=\\"text-align:center\\">Http代理，它能记录所有客户端和服务器的Http和Https请求响应</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Charles</td>\\n<td style=\\"text-align:center\\">设置代理抓取http包，MAC上对Charles支持更好</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">OmniPeek</td>\\n<td style=\\"text-align:center\\">更适用于无线网络、语音等技术</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">Firebug</td>\\n<td style=\\"text-align:center\\">Web调试工具，集成在Internet Explorer工具栏</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">HttpWatch</td>\\n<td style=\\"text-align:center\\">Web调试工具，网页浏览器Mozilla Firefox下的一款开发类插件</td>\\n</tr>\\n<tr>\\n<td style=\\"text-align:center\\">......</td>\\n<td style=\\"text-align:center\\"></td>\\n</tr>\\n</tbody>\\n</table>"}');export{P as comp,_ as data};
